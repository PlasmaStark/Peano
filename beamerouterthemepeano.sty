% ======================
% LOGOS
% ======================
\pgfdeclareimage[width=0.09\paperwidth]{primarylogo}{images/polito_logo_primary.png}
\pgfdeclareimage[width=0.09\paperwidth]{primarylogo_neg}{images/polito_logo_primary_negative.png}
\newcommand{\@primarylogo}{primarylogo}

% ======================
% FRAME TITLE
% ======================
\defbeamertemplate*{frametitle}{peano}[1][]
{
  \vskip-0.05cm%
  \begin{beamercolorbox}[wd=\paperwidth,ht=2cm,dp=0pt]{frametitle}
    \begin{tikzpicture}[remember picture,overlay]
      \useasboundingbox (0,0) rectangle (\the\paperwidth,2);

      % Shadow of color secondary
      \fill[polito-orange]
        (0,2.45) --
        (\the\paperwidth,1.95) --
        (\the\paperwidth,0.2) --
        (0, 1) --
        cycle;

      % Shape of color primary
      \fill[polito] 
        (0,2.5) --             
        (\the\paperwidth,2) -- 
        (\the\paperwidth,0.5) -- 
        (0,0) --                
        cycle;

      % Title & subtitle
      \ifx\insertframesubtitle\@empty%
        \node[anchor=west, white] at (0.4,1.2) {\insertframetitle};
      \else%
        \node[anchor=west, white] at (0.4,1.2) {\insertframetitle};
        \node[anchor=west, white, font=\small] at (0.4,0.7) {\insertframesubtitle};
      \fi
      
      % Logos on the right
    \begin{scope}[shift={(current page.north east)}, yshift=-0.45cm, xshift=-0.2em]
      \node[anchor=north east] (crypto) at (0,0)
        {\includegraphics[height=0.3cm]{images/crypto_logo_secondary_negative.png}};
    
      \coordinate (lineX) at ([xshift=-0.05cm]crypto.west);
      \draw[white, line width=1pt] 
        (lineX |- crypto.north west) -- 
        (lineX |- crypto.south west);
    
      \node[anchor=east] (polito) at ([xshift=-0.05cm]lineX |- crypto.center)
        {\includegraphics[height=0.9cm]{images/polito_logo_secondary_negative.png}};
    \end{scope}
    \end{tikzpicture}
  \end{beamercolorbox}
}

% ======================
% SECTIONS
% ======================
\AtBeginSection[]{
  \begingroup
  \setbeamercolor{normal text}{fg=polito}
  \setbeamercolor{structure}{fg=polito-orange}
  \setbeamercolor{section in toc}{fg=white}

  \setbeamertemplate{background}{
    \begin{tikzpicture}[remember picture, overlay]
      % Sfondo blu
      \fill[polito] (current page.south west) rectangle (current page.north east);

      % Logo watermark semitrasparente e spostato
      \node[anchor=south east, opacity=0.045, xshift=1cm, yshift=-1cm] 
        at (current page.south east) 
        {\includegraphics[height=0.7\paperwidth]{images/polito_logo_secondary_negative.png}};
    \end{tikzpicture}
  }

  \begin{frame}
    \centering
    \vspace*{1cm}
    \usebeamerfont{section title}
    \usebeamercolor[fg]{section in toc}
    \LARGE Table of Contents

    \vspace{0.5cm}
    \normalsize
    \tableofcontents[currentsection]
  \end{frame}

  % Ripristina background vuoto dopo questo frame
  \setbeamertemplate{background}{}
  \endgroup
}

% ======================
% FOOTER
% ======================
\setbeamertemplate{navigation symbols}{}
\defbeamertemplate*{footline}{customtheme}{%
  \ifnum\insertpagenumber=1
  \else
    \begin{beamercolorbox}[wd=\textwidth,ht=5mm,dp=3mm,rightskip=5mm]{footline}
      \hfill
      \insertframenumber/\inserttotalframenumber
    \end{beamercolorbox}
  \fi
}
